<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>修改客户单位库</title>
    <meta http-equiv="pragma" content="no-cache">
    <meta http-equiv="cache-control" content="no-cache">
    <meta http-equiv="expires" content="0">
    <meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
    <meta http-equiv="description" content="修改客户单位库">


    <link href="../image/ioc/favicon.ico" rel="icon" type="image/x-ico">
    <link rel="stylesheet" type="text/css" href="../js/layuiadmin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="./css/style.css">
    <link rel="stylesheet" href="./util/lgallery/css/lgallery.min.css">
    <link rel="stylesheet" href="./util/lgallery/css/demo.min.css">
    <link rel="stylesheet" href="../js/layuiadmin/style/login.css" media="all">

</head>
<body>
<div style="padding: 15px;">
    <form class="layui-form layui-form-pane">
        <div class="layui-form-item ">
            <div class="layui-inline">
                <label class="layui-form-label">设置用户名</label>
                <div class="layui-input-inline">
                    <input type="text" id="login_name" name="login_name" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline ">
                <label class="layui-form-label">设置密码</label>
                <div class="layui-input-inline">
                    <input type="text" id="login_pwd" name="login_pwd" required lay-verify="required" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">客户简称</label>
                <div class="layui-input-inline">
                    <input type="text" id="short_name" name="short_name" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">客户全称</label>
                <div class="layui-input-inline">
                    <input type="text" id="full_name" name="full_name" required lay-verify="required" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">客户类型</label>
                <div class="layui-input-inline">
                    <select id="type" name="type" required lay-verify="required">
                        <option value="">请选择一个类型</option>
                        <option value="1">大板车</option>
                        <option value="2">4s店</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">客户地址</label>
            <div class="layui-input-block">
                <input type="text" id="address" name="address" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">联系人</label>
                <div class="layui-input-inline">
                    <input type="text" id="contacts" name="contacts" required lay-verify="required" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">电话</label>
                <div class="layui-input-inline">
                    <input type="text" id="phone" name="phone" required lay-verify="required|phone" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">合同详情</label>
            <div class="layui-input-block">
                <button id="pz" photo-type="10" type="button" class="takePhoto layui-btn layui-btn-normal">拍照</button>
            </div>
        </div>
        <div id="photo10" class="layui-form-item hide">
            <fieldset class="layui-elem-field">
                <legend>合同照片</legend>
                <div class="layui-field-box">
                    <div class="TemplateParent" data-lgparent data-lgtitle="1,2,3,4,5"
                         data-lglabel="Picture 1,Picture 2,Picture 3,Picture 4,Picture 5"
                         data-lgdescription="Description 1, Description 2,Description 3,Description 4,Description 5">

                    </div>
                </div>
            </fieldset>
        </div>
        <!--        <div class="layui-form-item">-->
        <!--            <label class="layui-form-label">合同详情</label>-->
        <!--            <div class="layui-input-block">-->
        <!--                <button id="pz" type="button" class="layui-btn layui-btn-normal">拍照</button>-->
        <!--            </div>-->
        <!--        </div>-->


        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">账号</label>
                <div class="layui-input-inline">
                    <input type="text" id="bank_number" name="bank_number" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">开户银行</label>
                <div class="layui-input-inline">
                    <input type="text" id="bank_name" name="bank_name" required lay-verify="required" autocomplete="off"
                           class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">免费天数</label>
            <div class="layui-input-block">
                <input type="text" id="free_days" name="free_days" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">洗车费</label>
                <div class="layui-input-inline">
                    <input type="text" id="car_wash_fee" name="car_wash_fee" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">检验费</label>
                <div class="layui-input-inline">
                    <input type="text" id="car_check_fee" name="car_check_fee" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">停车费/天/台</label>
                <div class="layui-input-inline">
                    <input type="text" id="car_park_fee" name="car_park_fee" required lay-verify="required"
                           autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button type="button" class="layui-btn" lay-submit lay-filter="demo1">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
        <input type="hidden" name="id" id="kh_id">
    </form>
</div>
<div class="layui-trans layadmin-user-login-footer">
    <p style="color: white;">Copyright © 2019 by 中国联合网络通信有限公司宁波市分公司 All rights reserved.</p>
</div>
</body>

<script type="text/javascript" src="../js/jquery-1.8.3.min.js"></script>
<script src="../js/layuiadmin/layui/layui.js"></script>
<script type="text/javascript" src="../layer_mobile/layer.js"></script>
<script type="text/javascript" src="../js/jquery.md5.js"></script>
<script type="text/javascript" src="../js/jquery-geturlcode.js"></script>
<script type="text/javascript" src="../js/jquery.cookie.js"></script>
<script src="../js/common/api.js"></script>
<script src="../js/common/localjs.js"></script>
<script type="text/javascript" src="../js/mui.min.js"></script>
<script src="./util/lgallery/js/lgallery.min.js"></script>
<script type="text/javascript" src="../js/mui.min.js"></script>
<script>
    var form;
    var contracts = [];
    var customer_id = GetQueryString("id");

    //获取用户的信息
    function GetInfo() {
        //var storage_number = $.cookie("storage_number");
        var timestamp = (new Date()).valueOf();// 时间戳----
        //生成sign
        var MD5String = "customer_id=" + customer_id + "&timestamp=" + timestamp + pass;
        var MD5 = $.md5(MD5String);
        MD5 = MD5.toUpperCase();//字母转为大写
        var sign = pass + MD5;// 加密参数----
        var token = $.cookie("token");
        console.log("token-----" + token);

        $.ajax({
            type: "GET",
            url: Api.FWDT_Customer_Dw.Select_Customer_ById,
            data: {
                customer_id: customer_id,
                timestamp: timestamp,
                token: token
            },
            dataType: 'json',
            beforeSend: function (request) {
                request.setRequestHeader("KJCY-TOKEN", sessionStorage.getItem('token'));
                //request.setRequestHeader("FORM-TOKEN", fd);
                // request.setRequestHeader("Content-Type", "application/json");
            },
            success: function (res) {
                console.log("msg信息------", res.msg);
                console.log("数据------", res.data);
                fuzhi(res.data);

            },
            error: function (XMLHttpResponse, textStatus, errorThrown) {
                console.log("1 异步调用返回失败,XMLHttpResponse.readyState:" + XMLHttpResponse.readyState);
                console.log("2 异步调用返回失败,XMLHttpResponse.status:" + XMLHttpResponse.status);
                console.log("3 异步调用返回失败,textStatus:" + textStatus);
                console.log("4 异步调用返回失败,errorThrown:" + errorThrown);

            }
        });
    }


    function fuzhi(res) {

        $("#kh_id").val(res.id);

        $("#login_name").val(res.login_name);
        $("#login_pwd").val(res.login_pwd);
        $("#short_name").val(res.short_name);
        $("#full_name").val(res.full_name);

        $("#type").val(res.type);


        $("#address").val(res.address);
        $("#contacts").val(res.contacts);
        $("#phone").val(res.phone);
        $("#bank_number").val(res.bank_number);
        $("#bank_name").val(res.bank_name);
        $("#free_days").val(res.free_days);
        $("#car_wash_fee").val(res.car_wash_fee_str);
        $("#car_check_fee").val(res.car_check_fee_str);
        $("#car_park_fee").val(res.car_park_fee_str);


        if (res.contractShowList != null && res.contractShowList != "" && res.contractShowList.length > 0) {
            $("#photo10").show();
            $.each(res.contractShowList, function (idx, obj) {
                $("#photo10").children(".layui-elem-field").children(".layui-field-box").find(".LGallery").remove();
                $("#photo10").find(".TemplateParent").append('<div class="TemplateParent-Item" style="width: 10%"> <img src="' + obj.image_url + '"/> <span>合同照片</span> </div>');
                contracts.push_unique(obj.image_db);
            });
            initLG();
        }


        form.render();
    }


    //Demo
    layui.use(['jquery', 'form', 'layer'], function () {
        form = layui.form;
        var $ = layui.$,
            layer = layui.layer;


        GetInfo();

        //调用高拍仪
        $(".takePhoto").on("click", function () {
            var that = $(this);
            console.log(that.attr("photo-type"));
            var as = layer.open({
                id: "takePhoto",
                type: 2,
                title: '高拍仪',
                maxmin: true,
                //area: ['1500px', '800px'],
                //content : path+'/voteback/add.html',
                content: 'photoTest/indexTwo.html?type=' + that.attr("photo-type"), //iframe的url
                success: function (layero, index) {
                    //传入参数，并赋值给iframe的元素
                },
                end: function (res) {
                    console.log("存储的图片数组---", contracts);
                    initLG();
                }
            });
            layer.full(as);
        });


        //
        // $("#pz").on("click", function () {
        //     layer.open({
        //         type: 2,
        //         title: "拍照",
        //         area: ['900px', '500px'],
        //         //  offset: '50px',
        //         anim: 6,
        //         shadeClose: "true",
        //         skin: "layui-layer-molv",
        //         content: "photo.html"
        //     });
        // })
        //监听提交
        form.on('submit(demo1)', function (data) {
            //layer.msg(JSON.stringify(data.field));
            data.field.contracts = contracts;

            var json = data.field;
            console.log(json);

            ajaxSubmit(json, Api.FWDT_Customer_Dw.Add_Motify_Customer, "POST", function (res) {

                var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
                parent.layui.table.reload("transport_unit_library", {page: {curr: 1}});
                parent.layer.msg('修改成功');
                parent.layer.close(index);

            }, "json");


            // $.ajax({
            //     type: "POST",
            //     url: Api.FWDT_Customer_Dw.Add_Motify_Customer,
            //     data: json,
            //     dataType: 'json',
            //     beforeSend: function (request) {
            //        // request.setRequestHeader("KJCY-TOKEN", token);
            //         //request.setRequestHeader("FORM-TOKEN", fd);
            //         request.setRequestHeader("Content-Type", "application/json");
            //     },
            //     success: function (res) {
            //         console.log("msg信息------" + res.msg);
            //         alert("添加成功");
            //
            //     },
            //     error: function (XMLHttpResponse, textStatus, errorThrown) {
            //         console.log("1 异步调用返回失败,XMLHttpResponse.readyState:" + XMLHttpResponse.readyState);
            //         console.log("2 异步调用返回失败,XMLHttpResponse.status:" + XMLHttpResponse.status);
            //         console.log("3 异步调用返回失败,textStatus:" + textStatus);
            //         console.log("4 异步调用返回失败,errorThrown:" + errorThrown);
            //
            //     }
            // });


            return false;
        });
    });
</script>
</html>